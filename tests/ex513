#!/bin/env bats

setup() {
  bats_load_library bats-file
  bats_load_library bats-assert
  bats_load_library bats-support
}

# Tests for #5-13 tail program

@test "1. Default tail (10 lines): ex513 <<< 'line1\\\\nline2\\\\nline3\\\\nline4\\\\nline5\\\\nline6\\\\nline7\\\\nline8\\\\nline9\\\\nline10\\\\nline11\\\\nline12'" {
    run ex513 <<< $'line1\nline2\nline3\nline4\nline5\nline6\nline7\nline8\nline9\nline10\nline11\nline12'
    assert_success
    assert_output $'line3\nline4\nline5\nline6\nline7\nline8\nline9\nline10\nline11\nline12'
}

@test "2. Tail last 3 lines: ex513 -3 <<< 'line1\\\\nline2\\\\nline3\\\\nline4\\\\nline5'" {
    run ex513 -3 <<< $'line1\nline2\nline3\nline4\nline5'
    assert_success
    assert_output $'line3\nline4\nline5'
}

@test "3. Tail last 1 line: ex513 -1 <<< 'line1\\\\nline2\\\\nline3'" {
    run ex513 -1 <<< $'line1\nline2\nline3'
    assert_success
    assert_output "line3"
}

@test "4. More lines requested than available: ex513 -10 <<< 'line1\\\\nline2\\\\nline3'" {
    run ex513 -10 <<< $'line1\nline2\nline3'
    assert_success
    assert_output $'line1\nline2\nline3'
}

@test "5. Empty input: ex513 -5 <<< ''" {
    run ex513 -5 <<< ''
    assert_success
    assert_output ""
}

@test "6. Single line input: ex513 -3 <<< 'oneline'" {
    run ex513 -3 <<< 'oneline'
    assert_success
    assert_output "oneline"
}

@test "7. Zero lines requested: ex513 -0 <<< 'line1\\\\nline2\\\\nline3'" {
    run ex513 -0 <<< $'line1\nline2\nline3'
    assert_success
    assert_output ""
}

@test "8. Large input default: ex513 <<< 'a\\\\nb\\\\nc\\\\nd\\\\ne\\\\nf\\\\ng\\\\nh\\\\ni\\\\nj\\\\nk\\\\nl\\\\nm\\\\nn\\\\no'" {
    run ex513 <<< $'a\nb\nc\nd\ne\nf\ng\nh\ni\nj\nk\nl\nm\nn\no'
    assert_success
    assert_output $'f\ng\nh\ni\nj\nk\nl\nm\nn\no'
}

@test "9. Tail last 5 lines: ex513 -5 <<< 'a\\\\nb\\\\nc\\\\nd\\\\ne\\\\nf\\\\ng\\\\nh'" {
    run ex513 -5 <<< $'a\nb\nc\nd\ne\nf\ng\nh'
    assert_success
    assert_output $'d\ne\nf\ng\nh'
}

@test "10. Exactly n lines available: ex513 -3 <<< 'line1\\\\nline2\\\\nline3'" {
    run ex513 -3 <<< $'line1\nline2\nline3'
    assert_success
    assert_output $'line1\nline2\nline3'
}
